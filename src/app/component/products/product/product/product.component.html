<div class="container">
    <div class="row">

        <form [formGroup]="productForm" class="row" >
            <div class="product-back-button">
                <p class="btn-back" (click)="commonService.backClicked()"><img src="assets/img/arrow-right.svg" /> Back
                </p>
                <p>Add new product</p>
            </div>

            <div id="b4l-content"  class="b4l-height">
                <div class="product-name">
                    <p>Product Name</p>
                    <div class="product-name-details">
                        <input type="text" id="productName" formControlName="name" [(ngModel)]="product.name" placeholder="Eg. “Contactless invoice financing”" autocomplete="off">
                        <app-print-error [control]="f.name"  ></app-print-error>
                        <div class="product-details-btn">
                            <button *ngIf="isAdd" (click)="saveProduct(0)" href="javascript:void(0)" class="product-btn1"><img src="assets/img/save.svg" /> Save</button>
                            <button *ngIf="isAdd" (click)="saveProduct(1)" href="javascript:void(0)" class="product-btn3">
                                <img src="assets/img/send-to-checker-white.svg" /> Send to checker
                            </button>
                        </div>
                    </div>
                    <p class="product-note"><img src="assets/img/note.svg" /> This name will be visible to users who will be matched with this product</p>
                </div>
            </div>

            <!-- Matches Parameter start -->
            <div id="b4l-content">
                <div class="b4l-product-title">
                    <ul class="product">
                        <li><a [ngClass]="(isMatchesTab ? 'active' : '')" (click)="setTab(1)" href="javascript:void(0)">
                                <p>Matches Parameter</p>
                            </a></li>
                        <li><a [ngClass]="(!isMatchesTab ? 'active' : '')" (click)="setTab(2)" href="javascript:void(0)">
                                <p>Eligibility Calculation <span class="dot" style="color: red; font-size: large;" *ngIf="productForm.get('elgbltForm').invalid && productForm.submitted">•</span> </p>
                            </a></li>
                    </ul>
                    <a *ngIf="isMatchesTab" (click)="importParameterPopup('matches');" href="javaScript:void(0);"
                        class="product-btn1"><img src="assets/img/import.svg" /> Import Matches Parameter</a>
                    <a *ngIf="!isMatchesTab" (click)="importParameterPopup('eligibility');" href="javaScript:void(0);" class="product-btn1"><img
                            src="assets/img/import.svg" /> Import Eligibility Parameter</a>
                </div>
                <div [hidden]="!isMatchesTab">
                    <form formGroupName="paramForm">
                        <div class="matches-parameter" *ngIf="!product.parameters || !product.parameters.length">
                            <img class="img-match" src="assets/img/matches-parameter.svg" />
                            <p>We are ready to set eligibility parameters for the product.</p>
                            <p>You can either import parameters from existing product or set new parameters from scratch</p>

                            <div class="matches-parameter-data">
                                <a (click)="importParameterPopup('matches');" href="javaScript:void(0);" class="product-btn1"><img
                                        src="assets/img/import.svg" /> Import matches parameter</a>
                                <p>or</p>
                                <a (click)="addParameterPopup();" href="javaScript:void(0);" class="product-btn1">+ Add New
                                    Parameters</a>
                            </div>
                        </div>
                        <ng-container *ngIf="product.parameters.length > 0">
                            <div class="b4l-product-list" *ngFor="let item of this.product.parameters; index as i">
                                <div class="b4l-product-list-left">
                                    <p>{{i+1}}.</p>
                                    <p> {{item.lable}}</p>
                                </div>
                                <ng-container [ngSwitch]="item.inputType.id">
                                    <div class="b4l-product-list-right" *ngSwitchCase="inputType.YES_NO.id">
                                        <p class="buttin-b4l-opacity">
                                            <mat-button-toggle-group  formControlName="yesNo_{{item.parameterId}}"
                                                [(ngModel)]="item.answer">
                                                <mat-button-toggle [value]="true">Yes</mat-button-toggle>
                                                <mat-button-toggle [value]="false">No</mat-button-toggle>
                                            </mat-button-toggle-group>
                                            <img src="assets/img/close-red.svg" (click)="removeParameter(item)" />
                                        </p>
                                    </div>
                                    <div class="b4l-product-list-right" *ngSwitchCase="inputType.DROPDOWN.id">
                                        <p class="buttin-b4l-opacity">
                                            <select class="form-control" id="dropdown_{{item.parameterId}}" formControlName="dropdown_{{item.parameterId}}" [(ngModel)]="item.answer">
                                                <option  *ngFor="let option of item.lovs" [selected]="option.id == (item.answer ? item.answer.id : '')" [ngValue]="option.id">{{option.value}}
                                                </option>
                                            </select>
                                            <app-print-error [control]="pf['dropdown_'+item.parameterId]"  ></app-print-error>
                                            <img src="assets/img/close-red.svg" (click)="removeParameter(item)" />
                                        </p>
                                    </div>
                                    <div class="buttin-b4l-opacity opl2" *ngSwitchCase="inputType.RANGE.id">
                                        <div class="text-with-presnt person-text-width">
                                            <input placeholder="0" [(ngModel)]="item.answer.min" type="text" id="min_{{item.parameterId}}" formControlName="min_{{item.parameterId}}" >
                                            <p class="perstage-text-n-d">Days</p>
                                            <app-print-error [control]="pf['min_'+item.parameterId]"  ></app-print-error>
                                        </div>
                                        <p>to</p>
                                        <div class="text-with-presnt person-text-width">
                                            <input placeholder="0" [(ngModel)]="item.answer.max" formControlName="max_{{item.parameterId}}" id="max_{{item.parameterId}}" type="text">
                                            <p class="perstage-text-n-d">Days</p>
                                            <app-print-error [control]="pf['max_'+item.parameterId]"  ></app-print-error>
                                        </div>

                                        <img class="opl" src="assets/img/close-red.svg" (click)="removeParameter(item)" />
                                    </div>
                                </ng-container>
                            </div>
                        </ng-container>
                        <div class="b4l-product-list back">
                            <div class="b4l-product-list-right b4l-product-list-right1">
                                <p class="buttin-b4l-opacity">
                                    <a href="javascript:void(0)" class="product-btn3" (click)="addParameterPopup()">+ Add
                                        Parameters</a>
                                </p>
                            </div>
                        </div>
                    </form>

                </div>

                <!-- Eligibility Calculation start-->
                <div [hidden]="isMatchesTab">
                    <div class="b4l-product-list back">
                        <div class="b4l-product-list-left b4l-product-list-left1">
                            <p class="fnt-size-22">EBLR eligibility calculation method</p>
                            <p><span>EBLR currently set at {{eblr.plr}}%</span></p>
                        </div>
                        <div class="b4l-product-list-right title-eli-all">
                            <a href="javascript:void(0)" class="title-eli">Change eligibility model </a>
                        </div>
                    </div>

                    <form action="" formGroupName="elgbltForm"> 
                        <div class="b4l-product-list">
                            <div class="b4l-product-list-left">
                                <p>1</p>
                                <p>Working Capital Requirement<br>
                                    <span>Mostly lies between 15% to 25%. Depending on different situations</span></p>
                            </div>

                            <div class="b4l-product-list-right">

                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width">
                                        <input [(ngModel)]="product.wcRequirement"  formControlName="wcReq" placeholder="Enter percentage" type="text" >
                                        <p class="perstage-text-n-d">%</p>
                                        <app-print-error [control]="ef.wcReq"  ></app-print-error>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list back">
                            <div class="b4l-product-list-left">
                                <p>2</p>
                                <p>Max Loan amount as per limits</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width">
                                        <input [(ngModel)]="product.maxLoanAmtLimit"  formControlName="maxLoanAmnt" placeholder="Enter amount" type="text">
                                        <p class="perstage-text-n-d"><b>INR</b></p>
                                        <app-print-error [control]="ef.maxLoanAmnt"  ></app-print-error>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list">
                            <div class="b4l-product-list-left">
                                <p>3</p>
                                <p>Discounting Percentage</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width">
                                        <input [(ngModel)]="product.disPer" formControlName="disPercentage" placeholder="Enter percentage" type="text">
                                        <p class="perstage-text-n-d">%</p>
                                        <app-print-error [control]="ef.disPercentage"  ></app-print-error>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list back">
                            <div class="b4l-product-list-left">
                                <p>4</p>
                                <p>Tenure<br> <span>You need to specify tenure in months not year</span></p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width">
                                        <input placeholder="Enter months" formControlName="tenure" type="text" [(ngModel)]="product.tenure" >
                                        <app-print-error [control]="ef.tenure"  ></app-print-error>
                                        <p class="perstage-text-n-d"><b>Months</b></p>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="b4l-product-list">

                            <div class="b4l-product-list-left">
                                <p>5</p>
                                <p>Rate of Interest</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width1">
                                        <input [(ngModel)]="product.roi" (ngModelChange)="changeROI()" formControlName="roi" placeholder="Spread" type="text">
                                        <p class="perstage-text-n-d">%</p>
                                        <app-print-error [control]="ef.roi"  ></app-print-error>
                                    </div>
                                    <p class="text-input">+ {{eblr.plr || '-'}}% (EBLR) = {{finalROI}}%(Final ROI)</p>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list back">
                            <div class="b4l-product-list-left">
                                <p>6</p>
                                <p>Max Repayment Amount</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width">
                                        <input placeholder="Enter Amount" type="text" formControlName="maxRepay" [(ngModel)]="product.maxRepayAmt">
                                        <p class="perstage-text-n-d"><b>INR</b></p>
                                        <app-print-error [control]="ef.maxRepay"  ></app-print-error>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </form>

        <!-- Analyse now-->
        <div id="b4l-content" [hidden]="!isMatchesTab">
            <div class="matches-parameter">
                <img class="img-match" src="assets/img/Analyse-now.svg" />
                <p class="opacity-light">Just to be on safe side you can run simulation on sample applications.</p>
                <p class="opacity-light"> This will give you an idea how your matching will perform in real applications
                </p>
                <div class="matches-parameter-data">
                    <a href="#" routerLink="" class="product-btn4">Analyse Now</a>
                </div>
            </div>
        </div>
        <!-- Analyse now end-->

        <!-- Eligibility Calculator-->
        <div id="b4l-content" [hidden]="isMatchesTab">
            <div class="matches-parameter">
                <img class="img-match" src="assets/img/EligibilityCalculator.svg" />
                <p class="opacity-light">Just to be on safe side you can run simulation on sample
                    applications.</p>
                <p class="opacity-light"> This will give you an idea how your matching will perform in real
                    applications
                </p>
                <div class="matches-parameter-data">
                    <a href="#" routerLink="" class="product-btn4">Eligibility Calculator</a>
                </div>
            </div>
        </div>
        <!-- Eligibility Calculator end-->
    </div>
</div>