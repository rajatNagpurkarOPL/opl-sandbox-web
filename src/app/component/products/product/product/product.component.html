<div class="container">
    <div class="row">

        <form [formGroup]="productForm" class="row" >
            <div class="product-back-button">
                <p class="btn-back" (click)="commonService.backClicked()"><img src="assets/img/arrow-right.svg" /> Back
                </p>
                <p>Add new product</p>
            </div>

            <div id="b4l-content"  class="b4l-height">
                <div class="product-name">
                    <p>Product Name</p>
                    <div class="product-name-details">
                        <input type="text" id="productName" formControlName="name" [(ngModel)]="product.name" placeholder="Eg. “Contactless invoice financing”" autocomplete="off" #name>
                        <app-print-error [control]="f.name" [submitted]="submitted"></app-print-error>
                        <div class="product-details-btn">
                            <button *ngIf="isAdd" (click)="saveProduct(0)" href="javascript:void(0)" class="product-btn1"><img src="assets/img/save.svg" /> Save</button>
                            <button *ngIf="isAdd" (click)="saveProduct(1)" href="javascript:void(0)" class="product-btn3">
                                <img src="assets/img/send-to-checker-white.svg" /> Send to checker
                            </button>
                        </div>
                    </div>
                    <p class="product-note"><img src="assets/img/note.svg" /> This name will be visible to users who will be matched with this product</p>
                </div>
            </div>

            <!-- Matches, Eligibility, Charges Tabs -->
            <div id="b4l-content" class="b4l-height">
                <div class="b4l-product-title">
                    <ul class="product">
                        <li><a [ngClass]="(tab.matches ? 'active' : '')" (click)="setTab('matches', null)" href="javascript:void(0)"> <p>Matches Parameter
                            <span class="dot" style="color: red; font-size: large;" *ngIf="productForm.get('paramForm', roiRef).invalid && submitted">•</span>
                            </p> </a></li>
                        <li> <a [ngClass]="(tab.eligibility ? 'active' : '')" (click)="setTab('eligibility', wcReqRef)" href="javascript:void(0)">
                                <p>Eligibility Calculation <span class="dot" style="color: red; font-size: large;" *ngIf="productForm.get('elgbltForm', roiRef).invalid && submitted">•</span> </p>
                            </a>
                        </li>
                        <li>
                            <a [ngClass]="(tab.charges ? 'active' : '')" (click)="setTab('charges', roiRef)" href="javascript:void(0)"> <p>Charges & ROI
                                <span class="dot" style="color: red; font-size: large;" *ngIf="productForm.get('chargesForm', roiRef).invalid && submitted">•</span> </p> 
                            </a>
                        </li>
                </ul>
                    <a *ngIf="tab.matches" (click)="importParameterPopup('matches');" href="javaScript:void(0);"
                    class="product-btn1"><img src="assets/img/import.svg" /> Import Matches Parameter</a>
                    <a *ngIf="tab.eligibility" (click)="importParameterPopup('eligibility');" href="javaScript:void(0);" class="product-btn1"><img
                        src="assets/img/import.svg" /> Import Eligibility Parameter</a>
                </div>
                
                <!-- Matches Parameter start -->
                <div [hidden]="!tab.matches">
                    <form formGroupName="paramForm">
                        <div class="matches-parameter" *ngIf="!product.parameters || !product.parameters.length">
                            <img class="img-match" src="assets/img/matches-parameter.svg" />
                            <p>We are ready to set matches parameters for the product.</p>
                            <p>You can either import parameters from existing product or add new parameters from scratch</p>

                            <div class="matches-parameter-data">
                                <a (click)="importParameterPopup('matches');" href="javaScript:void(0);" class="product-btn1"><img
                                        src="assets/img/import.svg" /> Import matches parameter</a>
                                <p>or</p>
                                <a (click)="addParameterPopup();" href="javaScript:void(0);" class="product-btn1">+ Add New
                                    Parameters</a>
                            </div>
                        </div>
                        <ng-container *ngIf="product.parameters && product.parameters.length > 0">
                            <div class="b4l-product-list" *ngFor="let item of this.product.parameters; index as i">
                                <div class="b4l-product-list-left">
                                    <p>{{i+1}}.</p>
                                    <p> {{item.lable}}</p>
                                </div>
                                <ng-container [ngSwitch]="item.inputType.id">
                                    <div class="b4l-product-list-right" *ngSwitchCase="inputType.YES_NO.id">
                                        <p class="buttin-b4l-opacity">
                                            <mat-button-toggle-group  formControlName="yesNo_{{item.parameterId}}"
                                                [(ngModel)]="item.answer">
                                                <mat-button-toggle [value]="true">Yes</mat-button-toggle>
                                                <mat-button-toggle [value]="false">No</mat-button-toggle>
                                            </mat-button-toggle-group>
                                            <img src="assets/img/close-red.svg" (click)="removeParameter(item)" />
                                        </p>
                                    </div>
                                    <div class="b4l-product-list-right" *ngSwitchCase="inputType.DROPDOWN.id">
                                        <p class="buttin-b4l-opacity">
                                            <select class="form-control" id="dropdown_{{item.parameterId}}" formControlName="dropdown_{{item.parameterId}}" [(ngModel)]="item.answer">
                                                <option  *ngFor="let option of item.lovs" [selected]="option.id == (item.answer ? item.answer.id : '')" [ngValue]="option.id">{{option.value}}
                                                </option>
                                            </select>
                                            <app-print-error [control]="pf['dropdown_'+item.parameterId]" [submitted]="submitted" ></app-print-error>
                                            <img src="assets/img/close-red.svg" (click)="removeParameter(item)" />
                                        </p>
                                    </div>
                                    <div class="buttin-b4l-opacity opl2" *ngSwitchCase="inputType.RANGE.id">
                                        <div class="text-with-presnt person-text-width">
                                            <input placeholder="0" [(ngModel)]="item.answer.min" type="text" id="min_{{item.parameterId}}" formControlName="min_{{item.parameterId}}" >
                                            <p class="perstage-text-n-d">Days</p>
                                            <app-print-error [control]="pf['min_'+item.parameterId]" [submitted]="submitted" ></app-print-error>
                                        </div>
                                        <p>to</p>
                                        <div class="text-with-presnt person-text-width">
                                            <input placeholder="0" [(ngModel)]="item.answer.max" formControlName="max_{{item.parameterId}}" id="max_{{item.parameterId}}" type="text">
                                            <p class="perstage-text-n-d">Days</p>
                                            <app-print-error [control]="pf['max_'+item.parameterId]" [submitted]="submitted" ></app-print-error>
                                        </div>
                                        <img class="opl" src="assets/img/close-red.svg" (click)="removeParameter(item)" />
                                    </div>
                                </ng-container>
                            </div>
                        </ng-container>
                        <div class="b4l-product-list back">
                            <div class="b4l-product-list-right b4l-product-list-right1">
                                <p class="buttin-b4l-opacity">
                                    <a href="javascript:void(0)" class="product-btn3" (click)="addParameterPopup()">+ Add
                                        Parameters</a>
                                </p>
                            </div>
                        </div>
                    </form>

                </div>
                <!-- Matches Parameter End -->

                <!-- Eligibility Calculation start-->
                <div [hidden]="!tab.eligibility">
                    <div class="b4l-product-list back">
                        <div class="b4l-product-list-left b4l-product-list-left1">
                            <p class="fnt-size-22">EBLR eligibility calculation method</p>
                            <p><span>EBLR currently set at {{eblr.plr}}%</span></p>
                        </div>
                        <div class="b4l-product-list-right title-eli-all">
                            <a href="javascript:void(0)" class="title-eli">Change eligibility model </a>
                        </div>
                    </div>

                    <form action="" formGroupName="elgbltForm"> 
                        <div class="b4l-product-list">
                            <div class="b4l-product-list-left">
                                <p>1.</p>
                                <p>Working Capital Requirement<br>
                                    <span>Mostly lies between 15% to 25%. Depending on different situations</span></p>
                            </div>

                            <div class="b4l-product-list-right">

                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width">
                                        <input [(ngModel)]="product.wcRequirement"  formControlName="wcReq" placeholder="Enter percentage" type="text" #wcReq >
                                        <p class="perstage-text-n-d">%</p>
                                        <app-print-error [control]="ef.wcReq" [submitted]="submitted" ></app-print-error>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list back">
                            <div class="b4l-product-list-left">
                                <p>2.</p>
                                <p>Max Loan amount as per limits</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width">
                                        <input [(ngModel)]="product.maxLoanAmtLimit"  formControlName="maxLoanAmnt" placeholder="Enter amount" type="text">
                                        <p class="perstage-text-n-d"><b>INR</b></p>
                                        <app-print-error [control]="ef.maxLoanAmnt" [submitted]="submitted" ></app-print-error>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list">
                            <div class="b4l-product-list-left">
                                <p>3.</p>
                                <p>Discounting Percentage</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width">
                                        <input [(ngModel)]="product.disPer" formControlName="disPercentage" placeholder="Enter percentage" type="text">
                                        <p class="perstage-text-n-d">%</p>
                                        <app-print-error [control]="ef.disPercentage" [submitted]="submitted" ></app-print-error>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list back">
                            <div class="b4l-product-list-left">
                                <p>4.</p>
                                <p>Tenure<br> <span>You need to specify tenure in months not year</span></p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width">
                                        <input placeholder="Enter months" formControlName="tenure" type="text" [(ngModel)]="product.tenure" >
                                        <app-print-error [control]="ef.tenure" [submitted]="submitted" ></app-print-error>
                                        <p class="perstage-text-n-d"><b>Months</b></p>
                                    </div>
                                </div>
                            </div>

                        </div>
                        
                        <div class="b4l-product-list back">
                            <div class="b4l-product-list-left">
                                <p>5.</p>
                                <p>Max Repayment Amount</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width">
                                        <input placeholder="Enter Amount" type="text" formControlName="maxRepay" [(ngModel)]="product.maxRepayAmt">
                                        <p class="perstage-text-n-d"><b>INR</b></p>
                                        <app-print-error [control]="ef.maxRepay" [submitted]="submitted" ></app-print-error>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list back">
                            <div class="b4l-product-list-left">
                                <p>6.</p>
                                <p>Repayment plan</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width">
                                        <select class="form-control" formControlName="repayPlan">
                                            <option selected >One Time </option>
                                        </select>
                                        <!-- <app-print-error [control]="ef.maxRepay" [submitted]="submitted" ></app-print-error> -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list back">
                            <div class="b4l-product-list-left">
                                <p>7.</p>
                                <p>Disbursement plan</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width">
                                        <select class="form-control" formControlName="disbursePlan">
                                            <option selected >One Time </option>
                                        </select>
                                        <!-- <app-print-error [control]="ef.maxRepay" [submitted]="submitted" ></app-print-error> -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="b4l-product-list">
                            <div class="b4l-product-list-left">
                                <p>9.</p>
                                <p>Set Disbursement Account Priority <br> <span>Amount will be disbursed in account available according to priority order</span></p>
                            </div>
                            <div class="b4l-product-list-right last-width">
                                <div class="buttin-b4l-opacity opl2 last-flex">
                                    <p>Current priority order : Cash credit > Current > Overdraft > Savings > Other </p>
                                    <a href="javascript:void(0);" (click)="openAccountPriorityPopup()"  class="title-eli">Change Account Priority Order</a>
                                </div>
                            </div>
                        </div>
        
        
                    </form>
                </div>
                <!-- Eligibility Calculation End-->
                
                <!-- Charges & ROI Start -->
                <div [hidden]="!tab.charges">
                    <form formGroupName="chargesForm"> 
                        <div class="b4l-product-list">
                            <div class="b4l-product-list-left">
                                <p>1.</p>
                                <p>ROI</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <div class="text-with-presnt person-text-width1">
                                        <input [(ngModel)]="product.roi" (ngModelChange)="changeROI()" formControlName="roi" placeholder="Spread" type="text" #roi>
                                        <p class="perstage-text-n-d">%</p>
                                        <app-print-error [control]="cf.roi" [submitted]="submitted" ></app-print-error>
                                    </div>
                                    <p class="text-input">+ {{eblr.plr || '-'}}% (EBLR) = {{finalROI}}%(Final ROI)</p>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list">
                            <div class="b4l-product-list-left">
                                <p>2.</p>
                                <p>Late payment charges</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <select class="form-control" formControlName="dropdown1" [(ngModel)]="product.charge.latePayment.chargeType" (ngModelChange)="changeValidation(product.charge.latePayment.chargeType,'latePay')" >
                                        <option *ngFor="let option of chargeTypes" [selected]="option.value == product.charge.latePayment.chargeType" [ngValue]="option.value" >{{option.name}} </option>
                                    </select>
                                    <div class="text-with-presnt person-text-width2" *ngIf="product.charge.latePayment.chargeType == 'FIXED_AMOUNT'">
                                        <input [(ngModel)]="product.charge.latePayment.value" formControlName="latePay" type="text">
                                        <p class="perstage-text-n-d">INR</p>
                                        <app-print-error [control]="cf.latePay" [submitted]="submitted" ></app-print-error>
                                    </div>
                                    <div class="text-with-presnt person-text-width2" *ngIf="product.charge.latePayment.chargeType == 'RATE_BASED'">
                                        <input [(ngModel)]="product.charge.latePayment.value" formControlName="latePayRate" type="text">
                                        <p class="perstage-text-n-d">%</p>
                                        <app-print-error [control]="cf.latePayRate" [submitted]="submitted" ></app-print-error>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list">
                            <div class="b4l-product-list-left">
                                <p>3.</p>
                                <p>Bounce charges</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <select class="form-control" formControlName="dropdown2" [(ngModel)]="product.charge.bounce.chargeType" (ngModelChange)="changeValidation(product.charge.bounce.chargeType,'bounce')">
                                        <option *ngFor="let option of chargeTypes"  [selected]="option.value == product.charge.bounce.chargeType" [ngValue]="option.value" >{{option.name}} </option>
                                    </select>
                                    <div class="text-with-presnt person-text-width2" *ngIf="product.charge.bounce.chargeType =='FIXED_AMOUNT'">
                                        <input [(ngModel)]="product.charge.bounce.value"  (ngModelChange)="changeROI()" formControlName="bounce" type="text">
                                        <p class="perstage-text-n-d">INR</p>
                                        <app-print-error [control]="cf.bounce" [submitted]="submitted" ></app-print-error>
                                    </div>
                                    <div class="text-with-presnt person-text-width2" *ngIf="product.charge.bounce.chargeType == 'RATE_BASED'">
                                        <input [(ngModel)]="product.charge.bounce.value"  (ngModelChange)="changeROI()" formControlName="bounceRate" type="text">
                                        <p class="perstage-text-n-d" >%</p>
                                        <app-print-error [control]="cf.bounceRate" [submitted]="submitted" ></app-print-error>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list">
                            <div class="b4l-product-list-left">
                                <p>4.</p>
                                <p>Processing charges</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <select class="form-control" formControlName="dropdown3"  [(ngModel)]="product.charge.processing.chargeType" (ngModelChange)="changeValidation(product.charge.processing.chargeType,'processing')">
                                        <option *ngFor="let option of chargeTypes" [selected]="option.value == product.charge.processing.chargeType" [ngValue]="option.value" >{{option.name}} </option>
                                    </select>
                                    <div class="text-with-presnt person-text-width2" *ngIf="product.charge.processing.chargeType =='FIXED_AMOUNT'">
                                        <input [(ngModel)]="product.charge.processing.value" formControlName="processing" type="text">
                                        <p class="perstage-text-n-d" >INR</p>
                                        <app-print-error [control]="cf.processing" [submitted]="submitted" ></app-print-error>
                                    </div>
                                    <div class="text-with-presnt person-text-width2" *ngIf="product.charge.processing.chargeType == 'RATE_BASED'">
                                        <input [(ngModel)]="product.charge.processing.value" formControlName="processingRate" type="text">
                                        <p class="perstage-text-n-d">%</p>
                                        <app-print-error [control]="cf.processingRate" [submitted]="submitted" ></app-print-error>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="b4l-product-list">
                            <div class="b4l-product-list-left">
                                <p>5.</p>
                                <p>Prepayment charges</p>
                            </div>
                            <div class="b4l-product-list-right">
                                <div class="buttin-b4l-opacity opl2">
                                    <select class="form-control" formControlName="dropdown4" [(ngModel)]="product.charge.prepayment.chargeType" (ngModelChange)="changeValidation(product.charge.prepayment.chargeType,'prepayment')" >
                                        <option *ngFor="let option of chargeTypes" [selected]="option.value == product.charge.prepayment.chargeType" [ngValue]="option.value" >{{option.name}} </option>
                                    </select>
                                    <div class="text-with-presnt person-text-width2" *ngIf="product.charge.prepayment.chargeType == 'FIXED_AMOUNT'">
                                        <input [(ngModel)]="product.charge.prepayment.value" formControlName="prepayment" type="text">
                                        <p class="perstage-text-n-d">INR</p>
                                        <app-print-error [control]="cf.prepayment" [submitted]="submitted" ></app-print-error>
                                    </div>
                                    <div class="text-with-presnt person-text-width2"  *ngIf="product.charge.prepayment.chargeType =='RATE_BASED'">
                                        <input [(ngModel)]="product.charge.prepayment.value" formControlName="prepaymentRate" type="text">
                                        <p class="perstage-text-n-d">%</p>
                                        <app-print-error [control]="cf.prepaymentRate" [submitted]="submitted" ></app-print-error>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </form>
                </div>
                <!-- Charges & ROI End -->
            </div>
      
            <!-- Analyse now-->
            <div id="b4l-content" [hidden]="!tab.matches" class="b4l-height">
                <div class="matches-parameter">
                    <img class="img-match" src="assets/img/Analyse-now.svg" />
                    <p class="opacity-light">Just to be on safe side you can run simulation on sample applications.</p>
                    <p class="opacity-light"> This will give you an idea how your matching will perform in real applications
                    </p>
                    <div class="matches-parameter-data">
                        <a href="#" routerLink="" class="product-btn4">Analyse Now</a>
                    </div>
                </div>
            </div>
            <!-- Analyse now end-->

            <!-- Eligibility Calculator-->
            <div id="b4l-content" [hidden]="!tab.eligibility" class="b4l-height">
                <div class="matches-parameter">
                    <img class="img-match" src="assets/img/EligibilityCalculator.svg" />
                    <p class="opacity-light">Just to be on safe side you can run simulation on sample
                        applications.</p>
                    <p class="opacity-light"> This will give you an idea how your matching will perform in real
                        applications
                    </p>
                    <div class="matches-parameter-data">
                        <a href="#" routerLink="" class="product-btn4">Eligibility Calculator</a>
                    </div>
                </div>
            </div>
            <!-- Eligibility Calculator end-->
        </form>
    </div>
</div>